name: Push Workflow

on:
  push:
    branches: ["main"]

permissions:
  contents: write

jobs:

#Validate incoming HTML
  validate-static-site:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: List project files
        run: ls -R

      - name: Install HTMLHint
        run: npm install -g htmlhint

      - name: Validate HTML
        run: htmlhint "**/*.html"

      - name: Check large files
        run: |
          echo "Scanning for files larger than 5MB..."
          find . -type f -size +5M || true


#sync the main branch
  sync-branches:
    needs: validate-static-site
    runs-on: ubuntu-latest

    steps:
      - name: Checkout full repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch all branches
        run: git fetch --all


#branch list
      - name: Define branches to sync
        id: vars
        run: |
          echo "branches=Login/Register-user manage-posts post-skill/offer" >> $GITHUB_ENV


# merge each branch manually
      - name: Merge main into each branch
        run: |
          for branch in $branches; do
            echo "ðŸ”„ Updating $branch"

            # Check out the branch safely
            git checkout -B "$branch" "origin/$branch" || continue

            # Merge main
            git merge origin/main --no-edit || true

            # Push updates
            git push origin "$branch" || true
          done
